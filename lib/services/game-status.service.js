"use strict";var __decorate=this&&this.__decorate||function(e,t,r,i){var s,o=arguments.length,m=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)m=Reflect.decorate(e,t,r,i);else for(var c=e.length-1;c>=0;c--)(s=e[c])&&(m=(o<3?s(m):o>3?s(t,r,m):s(t,r))||m);return o>3&&m&&Object.defineProperty(t,r,m),m},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},core_1=require("@angular/core"),Subject_1=require("rxjs/Subject"),timer_service_1=require("./timer.service"),models=require("../models"),GameStatusService=function(){function e(e){var t=this;this.timer=e,this.subjectScore=new Subject_1.Subject,this.subjectLevel=new Subject_1.Subject,this.subjectLives=new Subject_1.Subject,this.subjectProblem=new Subject_1.Subject,this.subjectGameOver=new Subject_1.Subject,this.level=0,this.problem=0,this.score=0,this.lives=3,e.gameTimer.timeObservable.subscribe(function(e){return t.checkGameOver()}),this.subjectGameOver.subscribe(function(e){return console.log("Game Over",e)})}return e.prototype.startGame=function(e){this.gameLevels=e,this.subjectLevel.next(this.level),this.subjectProblem.next(this.problem),this.subjectLives.next(this.lives),this.timer.gameTimer.start(),this.timer.problemTimer.start();var t=this.getActualScoreConfig();this.timer.setProblemTimerConfig(t.preCount,t.withTime)},e.prototype.pauseGame=function(){this.timer.gameTimer.stop(),this.timer.problemTimer.stop(),this.timer.extraTimer.stop()},e.prototype.resumeGame=function(){this.timer.gameTimer.start(),this.timer.problemTimer.start(),this.timer.extraTimer.start()},e.prototype.onAnswer=function(e){e?this.setScoreAndTime():(this.subjectLives.next(--this.lives),this.checkGameOver()),this.nextProblem()},e.prototype.setScoreAndTime=function(){var e=this,t=this.getActualScoreConfig(),r=t.baseScore,i=t.extras.filter(function(t){return e.timer.problemTimer.time<=t.thresholdTime}).reduce(function(e,t){return e.thresholdTime<t.thresholdTime?e:t},new models.ExtraScore);this.timer.gameTimer.plusTime(i.extraTime),this.score+=r+i.extraScore,this.subjectScore.next(new models.Score(r,i.extraScore))},e.prototype.nextProblem=function(){this.gameLevels[this.level].gameProblems.length-1>this.problem?this.subjectProblem.next(++this.problem):this.nextLevel();var e=this.getActualScoreConfig();this.timer.setProblemTimerConfig(e.preCount,e.withTime)},e.prototype.nextLevel=function(){this.subjectProblem.next(this.problem=0),this.subjectLevel.next(++this.level),this.checkGameOver()},e.prototype.checkGameOver=function(){this.gameLevels&&(this.lives<=0?(this.pauseGame(),this.subjectGameOver.next(models.GameOverType.LIVES)):this.level==this.gameLevels.length?(this.pauseGame(),this.subjectGameOver.next(models.GameOverType.LEVELS)):this.timer.gameTimer.time<=0&&(this.pauseGame(),this.subjectGameOver.next(models.GameOverType.TIME)))},e.prototype.getActualProblem=function(){return this.gameLevels[this.level].gameProblems[this.problem]},e.prototype.getActualLevel=function(){return this.gameLevels[this.level]},e.prototype.getActualScoreConfig=function(){return this.getActualLevel().scoreConfig},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[timer_service_1.TimerService])],e)}();exports.GameStatusService=GameStatusService;